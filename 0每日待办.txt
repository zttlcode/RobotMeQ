步长10，900数据
0.7266666666666667  ClassCNN
0.6866666666666666  Transformer
0.666  TimesNet
0.57 Autoformer
0.57 PatchTST

步长10，全数据， 24.6万 train  14.6万 test
accuracy:0.6543299846756343   Transformer
accuracy:0.6468585050229866   PatchTST
accuracy:0.622203303252171    ClassCNN
accuracy:0.6169793972416142   Autoformer

步长250，全数据   模型可能要改架构
accuracy:0.6690059530805982  PatchTST
accuracy:0.6534491222490337  Transformer
accuracy:0.6397936818524382  ClassCNN

步长500，全数据
accuracy:0.6687597127136797  PatchTST
accuracy:0.635214974729444  ClassCNN

效果太差，打算放弃模型创新，转而计算收益率，与传统策略对比
发现实际分类结果几乎都无效，直观原因是样本不均 nature_quant里记录了

改损失函数权重后
accuracy:0.6053523177509905  timesnet
模型预测1000次就买对了6次，一次没卖对，还是无法计算收益

均衡数据集后，原形毕露了
accuracy:0.449523998413328    ClassCNN
accuracy:0.43395477984926617  timesnet
accuracy:0.41937723125743753  Informer
虽然低，但均衡，能统计收益了

20250205  改为21特征，5、15、30 macd+kdj+close 处理过样本不均
accuracy:0.6007740398928253 ClassCNN
accuracy:0.583407760246105  TimesNet

样本不均
accuracy:0.6961485010919198  ClassCNN
accuracy:0.690192574945404  TimesNet

这说明指标做特征确实有用

2025 0206 换模糊策略，6特征
accuracy:0.5362391282615215  ClassCNN
accuracy:0.5109467159852045  TimesNet


换策略：
    换模糊策略，回测拿交易点，先画图，再想标注法，应该不需要处理样本不均。
    日内交易是个不错的选择。但用的是波浪理论。 gpt找这个策略代码
    如果我能做成一个框架，让模型自己识别现在适合什么类型的策略  问问大模型


换市场：
    可能其他市场的策略效果比A股好

然后模型优化简单看看，然后主要精力开始做多模型。
2.2.2的混合模型是个没意思的事，走投无路了发论文用
最好还是清楚各种主流技术的特性，把他们用到适合他们的地方。这样用它就有理由了，而不是盲目瞎试出来的

用户可能需要检查策略本身是否存在问题
可以考虑调整分类问题的设定。比如将卖出和买入分开处理，或者将问题简化为二分类，比如有效买入和无效买入，有效卖出和无效卖出，这样可能每个任务的样本分布更均衡。
接受模型在卖出类上的性能有限，转而专注于优化买入信号，而卖出信号则采用其他方法处理。
干脆不处理样本不均，让每个策略做最擅长的事，macd+kdj只捕捉买点，二分类有效无效
评估指标方面，用户需要注意不要只看准确率，而应该关注召回率、F1分数，尤其是对少数类的表现。可能需要使用混淆矩阵、AUC-ROC曲线等来全面评估模型性能。

多模型：
    要不不同过滤法给各自模型训练，最后大家投票，反正都是判断同一个交易点
    macd+kdj也许适合时间序列类模型，要不这个策略用LSTM其他用CNN
    担心大盘同样走势，个股有涨有跌模型无法学习，要不股票分题材训练？
    不同题材给不同模型
    同样的大盘日线走势，有些在涨，有些在跌，让模型很矛盾，要么降低指数权重？
    怎么让模型知道，大盘指数这种形态时，涨的概率大？  学多了他会自己知道么？
    要不大盘指数单独走个CNN，做2分类，现在是上涨趋势还是下跌趋势？


    1.3 样本不均  （参考https://zhuanlan.zhihu.com/p/494220661）
        方案一：损失函数层面实验cost-sensitive，效果不佳
        方案二：删样本，效果提升（对应1.2方案二 缓解了小波动的连续买点）
                再尝试区间内加样本，让模型学区间
        方案三：模型层面用决策树 在2.2.3解决
        方案四：集成学习中bagging，把少的样本重复抽样，组成训练子集，给单个模型 在2.2.3解决

    2.2 模型方向
        2.2.1 基于目前单个CNN模型，持续优化，与时序模型比较     目前多级别数据合并6特征，一个CNN，有区别么？我看集成是为了防过拟合
                方案一：改数据集特征， 日线走势不够，正常人还得看指标
                        macd、KDJ、大盘成交量（日线小时成交量取消），这些数据重新组成数据集特征
                        （2019年那篇 CNN特征提取、后面的方法跟我差不多）
                方案二：改数据集？其他市场日线数据
                方案三：改训练？交叉验证
                方案四：模型架构层面，模型创新，模仿dlinear，优化个特别的CNN，实验效果好
                        思路：
                            1）不同特征组合的CNN模型： 如果你依然想保持每个特征的独立性，可以尝试设计一个多输入的CNN模型，
                                它可以同时处理这三个不同的特征（每个特征可以有自己独立的卷积层）。
                                通过这种方式，模型可以学会如何结合不同的时间尺度信息来判断股票走势，而不需要使用传统的集成学习方法。
                            2）残差?注意力？
                            3）我想识别趋势反转，相对位置信息？自注意力的位置编码，就是把位置信息做成形状相同的矩阵加到输入的矩阵，分绝对和相对
                        优势：目前实验结果有希望
                        劣势：时序官方数据集周期强，消融实验难赢，   抽窗口内序列特征的 时间上的规律不多

        2.2.2 混合模型
                参考：10、16
                （2022）A comprehensive review on multiple hybrid deep learning approaches for stock prediction
                    CNN。这个主要讲 CNN-LSTM。 输入信号（买卖信号），用卷积层提取特征，池化层降低kernel数，
                    flatten layer把所有特征转为单维向量，把单位向量作为输入传给LSTM层，
                    Fig6是流程图,Fig7是模型图，Fig8是算法示意图。
                    作者在结论总结了一下：LSTM and Hybrid LSTM 预测价格更好， CNN and Hybrid CNN预测趋势更好，
                    CNN-LSTM Hybrid适合资产组合，hybrid CNN and LSTM适合做日内高频
                LSTM能做分类吧？

        2.2.3 集成学习  优先
                优势：数据集特征加级别，加指标，对于一个CNN怕是太复杂了，也许投票真能解决预测错误问题，相当于二次过滤
                方案一：3个相同CNN，数据集特征相同，日线、小时线、大盘（对应1.3方案四 bagging）
                方案二：多个相同CNN，数据集特征不同——指标分开喂
                方案三：多个相同CNN，数据集特征不同——不同策略及其指标
                        王立新论文的 均线上穿下穿、突破支撑线阻力线、趋势线、布林带、MACD、模糊，他们带各自指标做特征，进CNN抽指标线特征
                            注意，回归类策略和趋势类策略可能犯冲
                方案四：对应1.3方案三 Boosting
                       模型：决策树 参考 https://blog.csdn.net/weixin_39807102/article/details/81912566
                                        lightGBM比XGboost更快更省内存     可以不看
                方案五：不同模型，cnn+lstm    多角度，多模型  不同模型解决不同问题。


创新点：
    1、思路创新，找别人代码复现，对比  + 传统！！！！！！！！！！！！
    2、样本不均，找相关论文的方法用！！！！！！！  搬别人的用
    4、CNN有道理的加东西，  改数据集特征  自注意力的位置编码  ！！！！！！！  1 试别人的
    5、搬别人的混合模型直接拿来用，效果好就行！！！！！！！！！
    6、集成学习的方案3不错  方案5不错  老师说没必要用集成学习那套，就按自己的想法混搭，各自训练后投票就行。先实验简单的

混模型、A+B已经被做烂了，做好的创新还是思路上的创新，认为这样可行，实践了发现可行
退一步讲，别人的方法解决了我的问题，也算创新

超参，数据，记录每次结果，避免随机变量
准确率至少0.6，
---------------------------------------------------------------------------------------


这种方法与传统金融策略做对比，投经济类期刊
一区期刊 Expert Systems With Applications
21发哪个期刊了，感觉很水
2019 有篇写作方式不错



下跌趋势的股票，默认是无法突破前高的，持有了下跌趋势的票，在股价接近前高时，先卖，再等低位接回
一个股票的趋势一旦反转，他不会直线一直涨（A股），等回撤买入。


akshare可以获取股东人数，可作为选股策略
什么题材都有故事，题材没用
主力吸收了一堆筹码，然后炒起来，卖给散户
只要主力没离场，这个股票总有大涨的机会
如果主力没来，这个股票就不需要关注
那我只要找到，主力来了，股票还没涨的，加入风投列表
然后风投的股票进入策略，等待买点出现，再等个卖点出现



数字币的期权，算概率也很不错

用期权进行策略实盘试验
当前价格100
预计5天后 会涨到110， 那我就买个5块，以100元（未来的低价）在5天后买，的期权，到了那天，真的超过110了，那我就行权，以100买入2手，马上以110价格卖出
                                                                  如果没有，那就损失个保证金
                                                                  期间我想止盈了，比如现在105，我可以卖给别人
预计5天后 会跌到90，  那我就买个5块，以100元（未来的高价）在5天后卖，的期权，到了那天，真跌了，我就在市场以90买个，马上以100卖给对方

所以，我可以只买10u，预测100u的波动。赢一次赚90u，输一次损失10u

合约在波动时有强制平仓风险，而期权不怕波动，损失固定，只要够小就可以
对冲，持有现货怕跌，买看跌期权，如果没跌，不行权，利润能盖过权利金。跌了，则对冲损失。
现货1000u1份，跌20%到800u，损失200u，要想对冲200u，则买1张看跌期权 1000u在5天后卖给对方，盈利为200u-1张的权利金（大概1%，也就是10u），即190u，
也就是说，1%，就能对冲，而且波动了百分之多少，就相当于盈利了多少倍杠杆。
如果1份价格过高，1%也很贵，这样可以买千分之一，原来赚190，现在只能转19u了，但花了1u。

他们现在买卖的，都是转卖的。比如 预计5天后到90，现在95，说明盈利5块了，那我卖5块，继续跌我才有的赚，不赚钱我5块全亏。
别看探索里转售的，直接买看涨期权，看跌期权，选日期，选心目中的价格，买个0.1张或更少即可。

币安的期权不用操作，赚了自动利润打到账户，赔了权利金直接扣掉。

期权不是100倍杠杆，
相当于自己开了个特殊杠杆
权利金就是当前和预期的价差，把价差补上，相当于自己买了个多倍合约，拥有了一个币，盈利就是1个币的价格相对期权价格的波动
这个价差越靠近当前价格，越正常，越离谱就越便宜（发生概率低，大概率扔钱）
所以，远期小概率时间收益最高，将近10倍收益
近期就是个普通的1倍，或者说一个币的波动利润

长期看涨的人远期看空对冲， 比如3800刀买了1个eth，就开空220刀1个eth  用5.7%的代价，换一个月的安心，当然涨过5.7%这样算没动，不然还要亏个5.7%作为买放心的代价

如果长期看空，那就买远期看涨对冲，比如1900刀一倍开空，270开涨，7%的代价，
总之在行权那天，如果涨破3800,270期权能弥补开空损失，但怕行权日之前涨超1900导致爆仓后又回落
                如果跌破3800，合约赚钱，但利润要大于270刀，才是真的赚

除了对冲以外，期权相当于一个防插针的合约
比如 当前3800，5刀明天看涨，到4000，才赚15刀
所以期权也有问题，就是权利金价格不稳定，200刀的利润，权利金应该是2刀  结果2刀利润只有7刀，降低了30倍