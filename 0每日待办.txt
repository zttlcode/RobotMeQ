步长10，900数据
0.7266666666666667  ClassCNN
0.6866666666666666  Transformer
0.666  TimesNet
0.57 Autoformer
0.57 PatchTST

步长10，全数据， 24.6万 train  14.6万 test
accuracy:0.6543299846756343   Transformer
accuracy:0.6468585050229866   PatchTST
accuracy:0.622203303252171    ClassCNN
accuracy:0.6169793972416142   Autoformer

步长250，全数据   模型可能要改架构
accuracy:0.6690059530805982  PatchTST
accuracy:0.6534491222490337  Transformer
accuracy:0.6397936818524382  ClassCNN

步长500，全数据
accuracy:0.6687597127136797  PatchTST
accuracy:0.635214974729444  ClassCNN

效果太差，打算放弃模型创新，转而计算收益率，与传统策略对比
发现实际分类结果几乎都无效，直观原因是样本不均 nature_quant里记录了

改损失函数权重后
accuracy:0.6053523177509905  timesnet
模型预测1000次就买对了6次，一次没卖对，还是无法计算收益

均衡数据集后，原形毕露了
accuracy:0.449523998413328    ClassCNN
accuracy:0.43395477984926617  timesnet
accuracy:0.41937723125743753  Informer
虽然低，但均衡，能统计收益了



0
    我的初衷是标注数据，做多变量时序分类，喂给模型抽特征。  思路创新
    1、这种方法与传统金融策略做对比，投经济类期刊  多变量时间序列分类在金融领域
    2、与其他方法的标注方法做对比实验，要找其他标注法
    3、模型创新，模仿dlinear，优化个特别的CNN，在多变量时序分类方向的金融领域，实验效果好

一个cnn优化
改数据集，改特征，加指标
集成学习，数据集分开
优化集成学习，除了cnn再加入lstm
遇到测试数据，出交易点，模型就去判断各级别形态，满足就是1， 不满足就是0，这时意见不一样，按照各自系数投票，日线是0.5，大盘0.3，小时0.1 和为1
也许集成的投票真能解决预测错误问题，相当于二次过滤
理论上来说，我也像XGBoost和残差一样，在优化和100%概率之间的差距，只是我是通过过滤的方式


https://blog.csdn.net/weixin_39807102/article/details/81912566
lightGBM比XGboost更快更省内存

不同特征组合的CNN模型： 如果你依然想保持每个特征的独立性，可以尝试设计一个多输入的CNN模型，
它可以同时处理这三个不同的特征（每个特征可以有自己独立的卷积层）。
通过这种方式，模型可以学会如何结合不同的时间尺度信息来判断股票走势，而不需要使用传统的集成学习方法。

增强特征多样性： 如果你希望通过集成学习来增强模型的表现，可以考虑从其他角度增加数据的多样性。
例如，使用不同的技术指标、增加更多的市场信息、或是引入不同类型的模型（如结合CNN和LSTM），而不仅仅是不同的特征视角。




加级别，加指标，只能是集成学习，  喂给一个CNN怕是太复杂了
指标可能比价格和成交量更好，什么指标策略，就把什么指标作为特征，就随便组合做实验呗
macd+kdj拼到数据集里，cnn能行么


1量化.txt参考文献
    29 标注方法，我当初也是想通过标注识别趋势反转   但回归策略交易点太多，4分类改为3分类会好些么？但样本数又要减少
             我也可以用v形过滤小波动
    2020那个哈工大也提了 数据标注是为了过滤短期随机性，要不我剔除5分钟？删除买卖后涨跌10%的？或者改成15%？过滤看哪个级别改变了大趋势？ 是个好想法
        启发：标注目前趋势，但macd这策略4分类了，不能标趋势，王立新那可以   我笃定信号标注+窗口走势分类了，别的标注都不显示，他们训练好
            直接靠模型预测的，极可能频繁出信号，比我策略的信号还多
        这和谢里夫理工大学2023年那个很像，评估用召回率准确率  我也试试？
    之前想法是一个策略多个级别给多个模型集成，现在多级别合一给一个模型
    我也可以不同策略给不同模型，比如趋势类的均线 日线级别（加个小时？自己的指标）给CNN， 模糊 日线？大盘？给CNN，MACD用V过滤后也给CNN
        这样大家都是判断趋势反转的，投票都说现在反转了，我就买
        这么一说，现在MACD回归类是想抄底，我干脆等确认趋势刚反转了再买，就是识别到没到低位反转后的第一次回落， 高位反转后最后一次冲高
            macd其实和tea他们老股民的风格吻合，建立底仓后，长期凭信号做波段，不断降低成本，要能等翻倍或吃股息就更好了
            所以把macd作为趋势策略跟模糊均线等做集成学习，可能不合适

            每个指标都有自己的风格，对应训练出的模型形态也不同，硬过滤方式不一样，只能做对比实验
            按照王立新论文指标
            均线上穿下穿
            突破支撑线阻力线
            趋势线
            大单，跌一直买，涨一直卖
            布林带，突破上轨买，突破下轨卖
            macd背离
            模糊策略 点位不错，但指标提升不了，只能用纯深度学习模型

    21发哪个期刊了，感觉很水  21、26 数据预处理
    2019年那篇 CNN特征提取、后面的方法跟我差不多
    2019 有篇写作方式不错
    一区期刊 Expert Systems With Applications
    我如果用现在模型当高频预测第二天价格涨跌，会不会有奇效？
    我也改交叉验证试试？
    换其他市场日线数据？

    我的初衷是指标信号能减少大部分交易点，使交易有道理。然后我再过滤有效的交易点，特征去抓当前特征，我究竟想抓什么？
        现在是日线走势和成交量，可这玩意在中国就跟猴市一样，我自己都看不出来，正常人还得看指标
        我现在用到的和主流的指标计算都没用到成交量，都是用开高低收。但股民都会看放量缩量
        那我现在的tea策略应该把macd、KDJ、大盘成交量（日线小时成交量取消），这些数据重新组成数据集。
        以后用啥策略直接给他指标做特征，价格可以给了试试，但我估计没用
            把新的挖掘特征的方法，用到老的框架，进行预测
            比如背离，破均线，均线走势等，他们常判断失效，但走势越明显，判断正确的概率就越大。
            现在的问题在于难以挖掘所谓的“走势非常明显”，如果挖掘出来，再把它喂给模型去抽取特征共性，再做判断，成功率会比传统方式高。
            只要挖掘出特征，再用不同的模型，可能都有提升


    现在大家数据集一样，最容易做的应该是3：先尝试优化CNN，看有没有希望，如果完全没头绪，太难，就直接放弃
            一个模型没法优化的话，混模型？
            1量化.txt参考文献 10、16
            （2022）A comprehensive review on multiple hybrid deep learning approaches for stock prediction
            3、CNN。这个主要讲 CNN-LSTM。 输入信号（买卖信号），用卷积层提取特征，池化层降低kernel数，
            flatten layer把所有特征转为单维向量，把单位向量作为输入传给LSTM层，
            Fig6是流程图,Fig7是模型图，Fig8是算法示意图。

            作者在结论总结了一下：LSTM and Hybrid LSTM 预测价格更好， CNN and Hybrid CNN预测趋势更好，
            CNN-LSTM Hybrid适合资产组合，hybrid CNN and LSTM适合做日内高频
            LSTM能做分类么
    然后是1，看起来简单，换到了金融领域，只要解决收益率统计问题，跟其他策略做对比测试即可。3做的尝试也不白费，也许能提出个新网络，忽悠搞金融的

        我希望的位置信息，是判断特征总结出这一段探底之后就会出现反转，
        所以时间段得长一点，包含了探底与反转，抓出反转点所在区间的特征，预测现在就是反转点的概率有多大，给我提示
        这一对信号，探底与反转，的相对位置信息
        自注意力，没有位置信息，一个办法是位置编码
        就是把位置信息做成形状相同的矩阵加到输入的矩阵，分绝对和相对，我肯定用相对


    2可能很难，同行的方法连代码都不公开，复现会花费很多时间，100多篇只见过四五篇做标注的

        比标注，只有多步分类V型、单步单步两个，其他标注的论文连代码都不公布，复现太耗时
            他们这两种方法是 2分类或3分类，  我是策略+过滤，4分类
            标注分类，生成concat_labeld.csv，
            数据集
            用timesnet,informer,CNN,等模型   统计准确率不合适，会蒙对，  统计mse等变评估模型了，  只能统计收益率
        创新点：  策略标注是思路创新，过滤没有任何技术可言
                 可对比的技术太少，量撑不起来
        结论：不写数据标注这个方向了吧，整个标注过程可以写到method里


    再看一下自己的笔记，提出问题，提出几个解决方案，周一汇报，等老师决策
    多次买固定金额，一次全卖
    报点位，截500送模型预测一次  直接拿测试集的点位就行，那就是读取concat labeled文件，
    buy and hold  原始未过滤的算收益，过滤后的肯定不能直接算收益，
    模型需要序列，输出分类，     我应该挑些concat labeled文件，做数据集但不标分类，每行做完后，把concat labeled文件另存一下，等模型标完分类，
    把这个分类写回作比较，同时按新分类统计收益率   同时按不分类直接统计收益率   再按buy and hold统计收益率
    三个收益率都是基于新得concat labeled文件文件，因为过滤是空数据或匹配不上序列导致的

    1 买入后，2%止损，
        止损后继续跌不操作
            又报新买点，买入，2%止损  如此循环，  比单边行情硬抗强， 买点密集就亏了
        止损后涨回去，买回来
      卖出信号出现后，直接卖
      这种方式只有一份资金，资金量不能大
    2、买入后，亏损硬抗，  还有买入信号继续买，
       卖出信号出现后，全卖
    3、买入后，有盈利就卖，短线  ，不顾卖出信号

    最好还是趋势操作，起码不用硬抗下跌趋势




按比例说，也就是日线看2年，500bar,小时看半年，500bar
小时、日线、大盘、3个cnn
	因为是3CNN一起训练，所以是集成学习
	如果我序列用多特征，每个特征一个通道还是每个特征一个cnn?应该没有一个特征一个cnn这样的吧？

	策略报点是策略，这就是全部指示来源。以后不论什么策略，都是给我报点，我才会决定交易。说买就涨，说卖就跌，就是好点位。
	交易后的止盈止损，属于仓位管理。跟策略没关系，不能为了仓位管理苛责策略。
	实际操作中，我不可能分级别，第一单级别不靠谱。第二1天多次信号我不能重复掏钱。就算一天提示多次，我日线上也就买一次。所以，必须合并点位
    无效的也把各上级抽500bar组成个序列分类为0，有效也上级500组成序列分类为1，

最后的效果就是，各个级别都在某一天提示交易了，记住各级别此时500bar的特征。

以后实盘时，出信号，先去分类，各级别会分别判断500bar，分类都一样最好，如果不一样，就要融合决策。
	那么，各级别是不是就是个特征呢？  四个模型集成学，与 四个500bar分别当作特征一起学，有区别么

自己的实验做完，还要研究创新点


什么题材都有故事，题材没用
主力吸收了一堆筹码，然后炒起来，卖给散户
只要主力没离场，这个股票总有大涨的机会
如果主力没来，这个股票就不需要关注
那我只要找到，主力来了，股票还没涨的，加入风投列表
然后风投的股票进入策略，等待买点出现，再等个卖点出现

作为风投，玩的是概率，资金太多影响心态和判断，每个不超过五千
买入后加入动态止损。这样我的资金跟着市场流动，不听故事，不关心新闻，只盯庄家

下跌趋势的股票，默认是无法突破前高的，持有了下跌趋势的票，在股价接近前高时，先卖，再等低位接回
一个股票的趋势一旦反转，他不会直线一直涨（A股），等回撤买入。

akshare可以获取股东人数，可作为选股策略
数字币的期权，算概率也很不错



用期权进行策略实盘试验
当前价格100
预计5天后 会涨到110， 那我就买个5块，以100元（未来的低价）在5天后买，的期权，到了那天，真的超过110了，那我就行权，以100买入2手，马上以110价格卖出
                                                                  如果没有，那就损失个保证金
                                                                  期间我想止盈了，比如现在105，我可以卖给别人
预计5天后 会跌到90，  那我就买个5块，以100元（未来的高价）在5天后卖，的期权，到了那天，真跌了，我就在市场以90买个，马上以100卖给对方

所以，我可以只买10u，预测100u的波动。赢一次赚90u，输一次损失10u

合约在波动时有强制平仓风险，而期权不怕波动，损失固定，只要够小就可以
对冲，持有现货怕跌，买看跌期权，如果没跌，不行权，利润能盖过权利金。跌了，则对冲损失。
现货1000u1份，跌20%到800u，损失200u，要想对冲200u，则买1张看跌期权 1000u在5天后卖给对方，盈利为200u-1张的权利金（大概1%，也就是10u），即190u，
也就是说，1%，就能对冲，而且波动了百分之多少，就相当于盈利了多少倍杠杆。
如果1份价格过高，1%也很贵，这样可以买千分之一，原来赚190，现在只能转19u了，但花了1u。

他们现在买卖的，都是转卖的。比如 预计5天后到90，现在95，说明盈利5块了，那我卖5块，继续跌我才有的赚，不赚钱我5块全亏。
别看探索里转售的，直接买看涨期权，看跌期权，选日期，选心目中的价格，买个0.1张或更少即可。

币安的期权不用操作，赚了自动利润打到账户，赔了权利金直接扣掉。

期权不是100倍杠杆，
相当于自己开了个特殊杠杆
权利金就是当前和预期的价差，把价差补上，相当于自己买了个多倍合约，拥有了一个币，盈利就是1个币的价格相对期权价格的波动
这个价差越靠近当前价格，越正常，越离谱就越便宜（发生概率低，大概率扔钱）
所以，远期小概率时间收益最高，将近10倍收益
近期就是个普通的1倍，或者说一个币的波动利润

长期看涨的人远期看空对冲， 比如3800刀买了1个eth，就开空220刀1个eth  用5.7%的代价，换一个月的安心，当然涨过5.7%这样算没动，不然还要亏个5.7%作为买放心的代价

如果长期看空，那就买远期看涨对冲，比如1900刀一倍开空，270开涨，7%的代价，
总之在行权那天，如果涨破3800,270期权能弥补开空损失，但怕行权日之前涨超1900导致爆仓后又回落
                如果跌破3800，合约赚钱，但利润要大于270刀，才是真的赚

除了对冲以外，期权相当于一个防插针的合约
比如 当前3800，5刀明天看涨，到4000，才赚15刀
所以期权也有问题，就是权利金价格不稳定，200刀的利润，权利金应该是2刀  结果2刀利润只有7刀，降低了30倍