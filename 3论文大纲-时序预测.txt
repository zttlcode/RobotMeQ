2、用标注好的数据训练模型
一  Introduction
金融预测学术体系现状
1995市场有效假说，认为所有预测都是无效的，价格在随机游走。
1、基本面分析
	利润，负债等作为特征，挑选有前景的股票
	这种模型相关研究少，因为他很难建立模型，也解释不了价格高频波动
	最多就用宏观指数
2、技术指标分析
	由价格、成交量衍生出各种指标，挖掘指标特征
3、消息驱动、情绪分析
	LLM预训练过来挺火


1、选股策略：
		机构行为分析：划分两个利益方，机构、散户。
			大家目的都是获取低价股本，机构要把散户洗掉。散户头铁，越跌越买。贪心的会低买高卖降低成本做波段；
		观察几年内机构持仓变化，股东人数变化，推测出机构成本，在机构成本附近买入，持有3、5年，硬等。
2、交易策略策略
	三大方向：均值回归、趋势跟随、套利
	1、均值回归：认为价格围绕价值上下波动，偏离多了总会回归
		具体策略：MACD+KDJ、网格策略
		应用场景：短期震荡、长期震荡
		特点：普通人用的最多，越跌越买，越套越深；
		      长期小收益，偶尔大亏损
	2、趋势跟随：坚信顺势而为的人生信条
		具体策略：多头排列、空投排列、最小阻力线、海龟法则等
		应用场景：长期单边行情
		特点：比均值人少些，属于老手，适合半职业，因为要长期盯盘
		      长期小亏损，偶尔大收益
	以上两个既可以预测方向，也可以预测价格，波浪理论（有个叫缠论的），画三角    确实有人在币里做到过高胜率，后来这人也没变首富，小众，因为打脸概率过高
	3、套利：比如两个同涨同跌的相关标的，偶尔出现价格偏离，但马上补回
		具体策略：高频
		应用场景：无限制
		特点：单次交易收益率太低，一般万分之5以下，需要资金量大，交易所附近搭建专业服务器降低延时
		      机构会这么做，比如文艺复兴基金



我希望的位置信息，是判断特征总结出这一段探底之后就会出现反转，
所以时间段得长一点，包含了探底与反转，抓出反转点所在区间的特征，预测现在就是反转点的概率有多大，给我提示
这一对信号，探底与反转，的相对位置信息
自注意力，没有位置信息，一个办法是位置编码
就是把位置信息做成形状相同的矩阵加到输入的矩阵，分绝对和相对，我肯定用相对

关于我自己的初衷leaner:
我想要的是，比如日线处于底背离的形态，30分钟也是底背离形态，然后此时均线，KDJ，MACD等等指标可能具有其他我没挖掘出的特征，此时买入后大概率涨。
这些特征，比如只需要250个样本，很久以前的样本跟此刻的形态没什么关系
（0524，不，15分钟级别，那就有关系了，因为省我看日线了），所以不需要transformer-based 模型，用CNN抽象出特征就行。
为什么不用LSTM？LSTM只是预测价格

(把新的挖掘特征的方法，用到老的框架，进行预测
比如背离，破均线，均线走势等，他们常判断失效，但走势越明显，判断正确的概率就越大。  
现在的问题在于难以挖掘所谓的“走势非常明显”，如果挖掘出来，再把它喂给模型去抽取特征共性，再做判断，成功率会比传统方式高。
只要挖掘出特征，再用不同的模型，都有提升，就可以发不同的文章。)





什么是指标？传统指标源于对资金博弈的分析，是量价及背后势力的行为反应，有道理，后来参与的人多成为共识，真有人在指标出现交易信号时出手（包括无人操作的量化策略）。
什么是策略？狭义的策略是指单个或多个指标所提炼出的交易信号，广义的策略也包括大资金对市场的操作时的计谋。除了买卖点，还应该有仓位管理（止盈止损等）。
指标为什么会失效？但由于市场的价格是多方合力的结果，有庄家（团队大资金）、游资（个体大资金）、散户（个体小资金）三种群体多方势力彼此尔虞我诈，通过不同策略（或计谋）从其他人口袋里骗钱。如果只奉行单个策略，当某个策略的信众力量薄弱时，该策略就会失效【王立新那论文】。
既然会失效，那我们在市场中获胜的理论依据是什么？增加盈利概率。金融本质是社会未来发展需求导致的资金流动，长期的经济趋势决定了大方向，选对了方向本就会使我们盈利的概率大于50%，为了利益最大化，则需要看长做短，在短期（一两年、几个月、几天、几小时、几分钟）博弈中寻找当前时间窗口内胜率较大的交易点位，使盈利概率在50%基础上再增加一点。市场看似水很深，但别害怕，纵使市场复杂，可结果无非涨跌，增加胜率具体如何做？对于资金量无法大到可以操纵市场的交易者来说，盈利只能来自于跟踪大资金量，要么在某方势头强劲时加入他们，要么在某方强弩之末时加入另一方。如何判断当前某方势力强弱？根据指标。非市场操作者能做的无非是组合不同时间级别的不同指标，筛选出成功率最高的交易机会。
那什么样的指标组合成功率高呢？比如同样是高位回落的底背离，双顶情况下的失败率远高于单顶；日线背离情况下小级别背离时反转的概率远高于小级别背离。这些都是传统指标的经验。现在需要做的，是在传统技术指标（大部分指标大同小异，主流的代表是macd，kdj，ma）的基础上，抽取指标有效时所在时间窗口的所有特征记为1，抽取指标失效时的特征记为0，以此实现在大于50%的胜率基础上进一步增加盈利概率。
这个方法的意义：
1、对于任何现有策略（传统指标策略，各种经典策略），该方法可以通过识别失效有效情况的特征增加策略胜率；
2、在逻辑上具有良好的可解释性；
3、相对于单独使用时间序列预测模型，他们要么是通过拟合直接预测价格（回归），由于每一刻的价格都要预测，胜率做不到太高，而我是传统指标出现时才需要预测一下，胜率更高，而且回归有个问题，预测价格确定了数值，但预测涨1.5%还是2.5%，难度很大，可能某个人心情好就多买了点，就会造成预测准确率下降，但其实这并没有关系，反正涨了，盈利了；要么模型先预测价格，然后不需要那么准确，只把预测价格的涨跌作为2分类。 但预测下一刻，几刻的方向，比较准确，他能预测是否未来几个月几天价格走势要彻底反转么？很蓝的啦，过于依赖模型，准确率会很快达到瓶颈难以提升，也降低了可解释性，但这么做的好处是训练数据简单。而用模型辅助抽取特征的方式，它不是在做实际预测，而是做特征匹配，唯一的难点就在于训练数据需要标注。

再捋一下，
时间序列也抽取了某个时间窗口的特征，看现在的价格走势满足过去哪些特征，以此特征做识别，识别以前遇到这种情况价格会涨还是跌。
我的方法也抽取了某个时间窗口的特征，看现在的价格走势满足过去哪些特征，以此特征做识别，识别以前遇到这种情况指标会不会失效。

理论上来说，我也像XGBoost和残差一样，在优化和100%概率之间的差距，只是我是通过过滤的方式

所以我的分类才是更好的分类，但以前没人这么搞，因为数据标注太难（1论文大纲-数据标注.txt或2论文大纲-数据标注-强化学习 解决了这个问题）。难度在于：
1、数据量大，假如1万个股票，10年数据，需要一个个标注哪个交易点有效，哪个失效。  （我通过回测+代码过滤实现）
2、上面1说的是单个级别。实际的指标运用时，常常会用多级别组合，比如日线背离前提下，分钟线背离，而正常的模型都是一个级别一个模型，两个级别模型之间没关系。而我想实现的，是 
15分钟级别数据进来时，指标判断买卖点出现，此时模型回去抓取30分钟，60分钟，日线级别250个时间窗口的特征，综合判断当前15分钟指标会失效还是有效；
30分钟进来，会判断60，日线级别， 就是只找当前级别的上级。  抓当前级别特征用处不大，因为都知道自己背离了，何必多次一举，肯定抓上级。
所以训练时需要多级别同时， （我有策略框架，这没问题）


二  related work
目前方向：
	时间序列回归预测
	时间序列方向预测
	模糊理论预测方向
	资产组合优化
	特征提取
	数据标注
	LLM在金融领域微调

	迁移学习
	CNN挖图
	更高维度
	多级别依赖关系
	数据增大 data augmentation
	同一行业内两个相关标的关系
	单步分类做高频  扩展：能做时间段预测么？不一定是买卖点，而是在一小段区域里买卖，模型输入时间段、输出也是时间段，而不是时间点，貌似这范围没啥用，
	可以自己定
	但也有用，毕竟价格波动大，不是高频的可能赶不上买，那还要不要买？预测时间段的没人干过，也许训练方式不同


三  method
	没有一个策略能适应所有情况，理智的做法是为各种情况作出应对方案。
	时序模型专门挖趋势型的，作为策略  这个策略只做长线趋势
	专门挖周期性的，作为策略  这个策略只做网格周期
	1、标的选择
		使用选股策略选出股票，长期持有
		选择指数
		所有股票都参与
	2、策略选择
		对于大众，均值、趋势是两个相反方向，每个方向都有几十种指标和策略，我选择打脸概率低的预测方向，引入分类任务，
		然后，在传统策略的基础上，挖掘潜在特征，过滤无效预测点，提升交易胜率 

四  experiment

评价指标：主要用sharpe ratio,ROI,max drawdown
评估模型性能的指标：主要用mean absolute percentage error (MAPE) - 33%, root mean square error (RMSE) - 33%, accuracy (31%),
mean absolute error (MAE) - 29%, mean squared error (MSE) - 29%, F measure (F1) - 20% and precision (20%)

评估性能用RMSE（ root mean square error）, MAPE, MAE，MSE等。



用期权进行策略实盘试验
当前价格100
预计5天后 会涨到110， 那我就买个5块，以100元（未来的低价）在5天后买，的期权，到了那天，真的超过110了，那我就行权，以100买入2手，马上以110价格卖出
                                                                  如果没有，那就损失个保证金
                                                                  期间我想止盈了，比如现在105，我可以卖给别人
预计5天后 会跌到90，  那我就买个5块，以100元（未来的高价）在5天后卖，的期权，到了那天，真跌了，我就在市场以90买个，马上以100卖给对方

所以，我可以只买10u，预测100u的波动。赢一次赚90u，输一次损失10u

合约在波动时有强制平仓风险，而期权不怕波动，损失固定，只要够小就可以
对冲，持有现货怕跌，买看跌期权，如果没跌，不行权，利润能盖过权利金。跌了，则对冲损失。  
现货1000u1份，跌20%到800u，损失200u，要想对冲200u，则买1张看跌期权 1000u在5天后卖给对方，盈利为200u-1张的权利金（大概1%，也就是10u），即190u，
也就是说，1%，就能对冲，而且波动了百分之多少，就相当于盈利了多少倍杠杆。
如果1份价格过高，1%也很贵，这样可以买千分之一，原来赚190，现在只能转19u了，但花了1u。

他们现在买卖的，都是转卖的。比如 预计5天后到90，现在95，说明盈利5块了，那我卖5块，继续跌我才有的赚，不赚钱我5块全亏。
别看探索里转售的，直接买看涨期权，看跌期权，选日期，选心目中的价格，买个0.1张或更少即可。

币安的期权不用操作，赚了自动利润打到账户，赔了权利金直接扣掉。

期权不是100倍杠杆，
相当于自己开了个特殊杠杆
权利金就是当前和预期的价差，把价差补上，相当于自己买了个多倍合约，拥有了一个币，盈利就是1个币的价格相对期权价格的波动
这个价差越靠近当前价格，越正常，越离谱就越便宜（发生概率低，大概率扔钱）
所以，远期小概率时间收益最高，将近10倍收益
近期就是个普通的1倍，或者说一个币的波动利润

长期看涨的人远期看空对冲， 比如3800刀买了1个eth，就开空220刀1个eth  用5.7%的代价，换一个月的安心，当然涨过5.7%这样算没动，不然还要亏个5.7%作为买放心的代价

如果长期看空，那就买远期看涨对冲，比如1900刀一倍开空，270开涨，7%的代价，
总之在行权那天，如果涨破3800,270期权能弥补开空损失，但怕行权日之前涨超1900导致爆仓后又回落
                如果跌破3800，合约赚钱，但利润要大于270刀，才是真的赚

除了对冲以外，期权相当于一个防插针的合约
比如 当前3800，5刀明天看涨，到4000，才赚15刀
所以期权也有问题，就是权利金价格不稳定，200刀的利润，权利金应该是2刀  结果2刀利润只有7刀，降低了30倍


五  result

六  conclusion




参考文献
# 时间序列模型
2017 transformer
transformer encoder多个头的结果压在一起，给decoder，
decoder循环，训练时，decoder inputs是未来的真实值；预测时，inputs是decoder的output上次的预测值

2020 ADD 股票数据特征提取
1、非纠缠结构分离 excess and market information
2、通过自蒸馏抹去部分因素
3、通过策略增加训练样本

**2021 informer**
稀疏概率降低复杂度，蒸馏使输入变长

**2021 Autoformer**
用到了decomposition，这个拆分（快速傅里叶变换FFT）基于 STL（季节性，趋势性），数据=趋势性数据+季节性数据（周期）+余项
auto-correlation代替注意力，因为作者认为数据不能简单由数值来判断，而应该根据趋势来判断，series-decomp用来把原始数据分解成季节（频繁小震荡）和趋势（大趋势），
auto-correlation利用随机过程的马尔可夫过程，以涛为时间窗口，计算分解后的两个周期对应那两小段的相关性，是个标量（最后加个softmax保证计算出的多个标量和是1），多个计算的标量连起来就是个趋势。
编码器是原始输入，解码器是拆分后的季节性和趋势性
结论：他对季节性周期性强的数据，预测效果最好，比如车流（有早晚高峰，工作日比周末车少）

**2022 Dlinear**
双线性结构。decomposition先分解原数据的趋势和季节。
论文里的金融预测图
对于周期性不强的金融数据，mse这类评价指标低真没啥用，图说明，模型只是简单延续了趋势，并不能预测趋势反转，
属于 MLPs

**2022 TDformer**
Trend Decomposition Transformer
20引用
各个趋势用自己适合的注意力机制

**2023 mamba**
循环神经网络 训练慢，推理快， transformer训练快，推理慢，mamba两个都快，训练时并行计算，推理时递归计算。
让SSM由时不变改为时变。速度快了2.8倍，内存少了86%

**2023 GBT**
Two-stage transformer framework for non-stationary time series forecasting
认为decoder inputs存在问题：不同局部窗口数据分布不均
现有的decoder inputs设计：
	informer：start token前移几位作为decoder的输入
	FEDFormer：趋势分解方式
这两个都没有解决过拟合问题
创新点：
	two stage:第一阶段通过对比学习获得输入序列的通用特征映射，第二阶段通过第一阶段和回归器输出的表征获得预测结果
	good begin：第一阶段的输出做第二阶段的输入

**2023 ITRANSFORMER**
INVERTED TRANSFORMERS AREEFFECTIVE FOR TIME SERIES FORECASTING
认为transformer-based模型不如Dlinear是因为token的不恰当使用
多个特征取了相同时间位置的token，但应该每个特征看作一个token
通过自注意力机制捕获特征之间的相关性
学习序列和全局的关系
金融预测效果比dlinear差一点

**2023 TimesNet**
时间序列的多周期性，互相重叠，互相影响
通过建模同时表示周期内和周期间的变化
autoformer团队的
属于CNNs

**2023 PatchTST**
原来的transformer是点对应token，现在是时间段对应token
通道独立，每个特征各自进transformer
目前效果最好的时间序列预测

2023SegRNN 
也是分段 + 通道独立

2023 StockFormer
Learning Hybrid Trading Machines with Predictive Coding
强化学习，但又跟普通的马科夫不一样，收益从0.4%提升到2%，一般
StockFormer consists of two training phases: predictive coding and policy learning

2023 Stock and market index prediction using Informer network
LSTM在时序预测上处于统治地位 ，Transformer有超越他的潜力，但现在这方面研究不够深入 
在长序列预测上，Informer比LSTM、Transformer表现更好

**2024 TimeMixer**
autoformer团队的
完全基于MLP模型，简单
多尺度混合：
	历史信息提取阶段：分解多个尺度变化
	预测阶段：多预测器混合多尺度信息
实验结果显示他是第一，TimesNet第二，PatchTST第三

**2024 TimesFM**
A DECODER-ONLY FOUNDATION MODEL FOR TIME-SERIES FORECASTING
zero-shot，不用在新数据集上训练，直接能用
预训练模型：patch input , decoder only , attention model
预训练数据集：作者做了个大型时序语料库
预测数据集：对不同领域可以zero-shot预测
NLP有跨任务zero-shot/few-shot learning的能力，这启发了时间序列预测，目前有两个研究方向：先预训练模型再给时间序列用；修改LLM模型给时间序列用
效果跟patchTST差不多

2024 MambaOut Do We Really Need Mamba for Vision
mamba适合长序列预测，视觉方面比不过卷积类模型

2024 Can Transformers Transform Financial Forecasting?
TFT、Informer、Autoformer、PatchTST 处理复杂时间序列数据很厉害，但之前有人用金融数据测的不严格，所以这次作者严格评测一下这四个。
作者之所以选这四个是因为他们在Nixtla这个神经网络实验评测的python库里
Q是当前对市场的分析，K是市场历史事件，V是市场历史事件对应当时的数据。
多头注意力类似同时考虑价格、成交量等
数据from July 1, 2007, to June 30, 2021.  Standard & Poor’s 100 (S&P 100) index
指标RMSE,MAE,MAPE
结论，Informer（长短期都强）最好，Autoformer（更适合短期）、PatchTST（更适合长期）一般，TFT不行

2024 Time Evidence Fusion Network
Evidence theory 1976年提出，融合信息做决策的 ，2000年有人用这个扩展为网络做分类，现在作者用这个做回归 Time Evidence Fusion Network
TEFN，把时间序列分为 时间BPA、通道BPA， 每个BPA又各自把序列扩散成多个mass,  (BPA源自模糊集理论)
本文说自己第一，PatchTST第二，TimesNet第三，autoformer和dlinear最后

**2024 KAN** 
Kolmogorov–Arnold Networks
能抽象出公式
MLP受universal approximation theorem启发，固定了激活函数作为层中的节点，
KAN受Kolmogorov-Arnold representation theorem启发，使用可学习的激活函数作为计算节点值的权重，因此没有权重矩阵，用1元函数代替了
KAN外表是MLP结构，内部是spline，使他不仅能学习特征，还能更精确。
KA是：如果f是个多元连续有界函数，则f可由有限个1元变量累加表示。人们想用ML学出这个1元函数，但这些函数可能是不可导的，所以KA被ML放弃了
但作者觉得科学中和生活中大部分函数都是可导的，应该关注典型的例子，而不是最坏的例子。
KAN的架构就是把每个1元函数参数化为B-spline curve，
例子，Alice想用KAN拟合2.22那个函数（两个输入，一个输出）。步骤是：
先建立（2,5,1）形状的全连接层（这是2层网络（x,x,x,x）这是3层网络），通过稀疏化训练，裁减掉80%隐藏层，得到（2,1,1）形状，假设出符号函数作为网络中的激活函数，继续训练直到准确率下降以确定参数，得到最终的符号函数。
这篇文章并不是独创KAN网络[n, 2n + 1, 1]，而是把这个网络泛化成任意的广度和深度。
We would also like to apply KANs to machinelearning-related tasks, which would require integrating KANs into current architectures, e.g., transformers – one may propose “kansformers” which replace MLPs by KANs in transformers.
KAN优点是可解释性和准确率，缺点是比MLP训练慢10倍，但作者认为这是个工程问题。
https://github.com/kindxiaoming/pykan
https://github.com/remigenet/SigKAN  预测均值或中位数让数据更平稳。

**2024 Diffusion-TS**

2024 A Novel Decision Ensemble Framework
Customized Attention-BiLSTM and XGBoost for Speculative Stock Price Forecasting
用BTC-USDT训练

2024 Literature Review
Machine Learning in Stock Predictions
prediction：Linear Regression, XGBoost, LSTM, ARIMA, and GARCH 这5个是预测价格
classification：Random Forest, Logistic Regression, Adaboost, GRU, and CNN 这5个分类趋势

2024 FinRobot 
An Open-Source AI Agent Platform
应用的结果不准。 用LLM分析新闻预测涨跌的
