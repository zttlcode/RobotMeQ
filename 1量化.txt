一  Introduction
金融预测学术体系现状
    1995市场有效假说，认为所有预测都是无效的，价格在随机游走。
        1、基本面分析
            利润，负债等作为特征，挑选有前景的股票
            这种模型相关研究少，因为他很难建立模型，也解释不了价格高频波动
            最多就用宏观指数
        2、技术指标分析
            由价格、成交量衍生出各种指标，挖掘指标特征
        3、消息驱动、情绪分析
            LLM预训练过来挺火
    策略
        1、选股策略：
                机构行为分析：划分两个利益方，机构、散户。
                    大家目的都是获取低价股本，机构要把散户洗掉。散户头铁，越跌越买。贪心的会低买高卖降低成本做波段；
                观察几年内机构持仓变化，股东人数变化，推测出机构成本，在机构成本附近买入，持有3、5年，硬等。
        2、交易策略策略
            1、均值回归：认为价格围绕价值上下波动，偏离多了总会回归
                具体策略：MACD+KDJ、网格策略
                应用场景：短期震荡、长期震荡
                特点：普通人用的最多，越跌越买，越套越深；
                      长期小收益，偶尔大亏损
            2、趋势跟随：坚信顺势而为的人生信条
                具体策略：多头排列、空投排列、最小阻力线、海龟法则等
                应用场景：长期单边行情
                特点：比均值人少些，属于老手，适合半职业，因为要长期盯盘
                      长期小亏损，偶尔大收益
            以上两个既可以预测方向，也可以预测价格，波浪理论（有个叫缠论的），画三角    确实有人在币里做到过高胜率，后来这人也没变首富，小众，因为打脸概率过高
            3、套利：比如两个同涨同跌的相关标的，偶尔出现价格偏离，但马上补回
                具体策略：高频
                应用场景：无限制
                特点：单次交易收益率太低，一般万分之5以下，需要资金量大，交易所附近搭建专业服务器降低延时
                      机构会这么做，比如文艺复兴基金
    提出这个思路的合理性：
        什么是指标？传统指标源于对资金博弈的分析，是量价及背后势力的行为反应，有道理，后来参与的人多成为共识，真有人在指标出现交易信号时出手（包括无人操作的量化策略）。
        什么是策略？狭义的策略是指单个或多个指标所提炼出的交易信号，广义的策略也包括大资金对市场的操作时的计谋。除了买卖点，还应该有仓位管理（止盈止损等）。
        指标为什么会失效？但由于市场的价格是多方合力的结果，有庄家（团队大资金）、游资（个体大资金）散户（个体小资金）2种群体多方势力彼此尔虞我诈，
        通过不同策略（或计谋）从其他人口袋里骗钱。如果只奉行单个策略，当某个策略的信众力量薄弱时，该策略就会失效【王立新那论文】。
        既然会失效，那我们在市场中获胜的理论依据是什么？增加盈利概率。金融本质是社会未来发展需求导致的资金流动，长期的经济趋势决定了大方向，
        选对了方向本就会使我们盈利的概率大于50%，为了利益最大化，则需要看长做短，在短期（一两年、几个月、几天、几小时、几分钟）博弈中寻找当前时间窗口内胜
        率较大的交易点位，使盈利概率在50%基础上再增加一点。市场看似水很深，但别害怕，纵使市场复杂，可结果无非涨跌，增加胜率具体如何做？
        对于资金量无法大到可以操纵市场的交易者来说，盈利只能来自于跟踪大资金量，要么在某方势头强劲时加入他们，要么在某方强弩之末时加入另一方。
        如何判断当前某方势力强弱？根据指标。非市场操作者能做的无非是组合不同时间级别的不同指标，筛选出成功率最高的交易机会。
        那什么样的指标组合成功率高呢？比如同样是高位回落的底背离，双顶情况下的失败率远高于单顶；日线背离情况下小级别背离时反转的概率远高于小级别背离。
        这些都是传统指标的经验。现在需要做的，是在传统技术指标（大部分指标大同小异，主流的代表是macd，kdj，ma）的基础上，
        抽取指标有效时所在时间窗口的所有特征记为1，抽取指标失效时的特征记为0，以此实现在大于50%的胜率基础上进一步增加盈利概率。
        这个方法的意义：
            1、对于任何现有策略（传统指标策略，各种经典策略），该方法可以通过识别失效有效情况的走势增加策略胜率；
            2、在逻辑上具有良好的可解释性；
            3、相对于单独使用时间序列预测模型，他们要么是通过拟合直接预测价格（回归），由于每一刻的价格都要预测，胜率做不到太高，
        时间序列预测回归与时间序列分类的区别：
            时间序列也抽取了某个时间窗口的特征，看现在的价格走势满足过去哪些特征，以此特征做识别，识别以前遇到这种情况价格会涨还是跌。
            我的方法也抽取了某个时间窗口的特征，看现在的价格走势满足过去哪些特征，以此特征做识别，识别以前遇到这种情况指标会不会失效。
            多变量时间序列分类在金融领域做的少是因为数据标注不容易。
        -------------------------------
        数据标注
            分类
                多步分类：
                    使用传统策略，回测出传统策略买卖点，硬过滤
                    寻找极值点
                单布分类：
                    不需要任何策略，只判断价格与前一个的关系
            回归
                不需要标注
        目标：收益率超越传统策略
        思路：多变量时间序列分类，金融领域，传统指标过滤数据集，CNN提取多级别、多标的窗口特征

            传统策略标注 + 决策融合
            解释性：一种策略无法适用所有情况，只能因地制宜，每个策略做自己最擅长的事

    项目代号：本质
    项目描述：炒股无非是看看各级别的k线、成交量，综合做决策，
    本方法通过机器学习挖掘各级别之间的关系，分类当前交易点是否有效，并投票
    实验用于回测，实盘用于实际交易

    模型分类的，是此信号有效，无效，而不是买卖  有效为1，失效为0
    有效就报信号，无效就不报
    我的方法也抽取了某个时间窗口的特征，看现在的价格走势满足过去哪些特征，以此特征做识别，识别以前遇到这种情况指标会不会失效。  ！！！！！！！！

    那我标注时，应该把所有交易点都留下，无效的标为无效，有效的标为有效，固定窗口
    抓特征只抓上级

二  related work
    目前方向：
            时间序列回归预测
            时间序列方向预测
            模糊理论预测方向
            资产组合优化
            特征提取
            数据标注
            LLM在金融领域微调

            迁移学习
            CNN挖图
            更高维度
            多级别依赖关系
            数据增大 data augmentation
            同一行业内两个相关标的关系
            单步分类做高频
    人家极值标，我指标标，我更具有实用性，信号可能更少，更能过滤波动，且传统指标具有可解释性。
    训练时，我创新了多级别，多标的加入投票。他们既有自己的参数，又有系数，看起来是集成学习。投票系数超参可以再探索

三  method
1、选一个指标策略，回测所有数据，拿到交易点
2、硬过滤交易点
这里谈一下关于标注的思考，以及是否可做创新点单独发论文：
    1）交易应该在区间，而不是点。
        对于策略来说，底部是个范围，买点出现后有的直接拉升，也有可能底部盘整一阵子再拉升，底部区间任意买都对。
        如果把点卡的太死，只有极值点是对的，附近都不对，这不现实。模型不要太灵敏，换言之模型不要学得太死板，
        比如策略给出底部区间多个买点，我只留一个，那相当于底部区间内的其他样本我少学了。
     2）训练时，让模型学习交易点附近的区间
        我不知道有没有学习区间的方式。我目前能想到的是：
        对于回归类策略，本身买点就多，那这么连续买点我都学。由于这个策略或市场导致卖点少，那我可以在卖点区间内制造一些卖点，除了让模型
        学区间，还能解决样本不均问题。
     3）目前标注领域都是V型找极值点，我认为他们的出发点是错的。
        在历史行情中标注出完美的极值点是可以实现的。训练出模型后，以后交易全靠模型，他还会像历史行情时那么完美么？难说，黑盒，缺乏可解释性。
     4）我的方法是在策略交易点的基础上，进行过滤。
        我具备可解释性，知道自己要学区间，要避免买在山腰，要避免底部买完涨一点就卖。
        他们是全靠自己标
        我是策略拿到点，自己标有效无效买卖，4类
        我不需要他们的方法，如果我拿自己的点跟他们标出来的比，肯定很少有对上的
        历史行情比点位收益没意义，都是过滤出来的。
        当作个小创新点吧，后面模型见，比收益率

2025 01 23 剔除5分钟级别，理由如下
    数据标注是为了过滤短期随机性，找大趋势拐点。
    5分钟级别交易点相隔较近，甚至隔天出现买卖。
    从实盘角度来说，一路跌一路买，底部刚拉升必然有5分钟、15分钟顶背离。此时卖出是要避免。退一步讲我要做短线，5分钟适合震荡，但实验表明，
        5分钟最终持仓量是15分钟的2倍，30分钟的6倍，60分钟的10倍，日线的20倍。且收益率和其他分钟级几乎持平。
        贪婪绝非理智。
    从特征提取难度来说，而特征提取是日线级别、小时线变化，500个时间步内只有1个时间步不同，就导致分类完全改变，这对模型来说很难。
        我换种方式呢？5分钟的信号让15分钟抽取500步特征，有用，能操作。但小级别往往具有相似性，5分钟背离，15分钟就长这样，
        日线既有可能是底背离，也有可能是高位双顶后的回落落成了小级别底背离。
        所以，还是要看高级别特征，5分钟和15分钟决定不了趋势。就算以后CNN各级别投票，也最多到15分钟。
2025 01 24 放弃剔除，理由如下
    5分钟缺点是频繁，忽略大趋势，特征提取不容易
    但是，经过实验，800个股票其中82%收益率高于不含5分钟交易点的股票。但是仓位翻倍。
    5分钟的优点是，不用担心错过交易点。
    缺点通过其他办法解决吧，这种短线策略总有适合自己的市场，只是需要我发掘。

2025 02 04 关于处理样本不均：
    tea策略买入点太多，filter1过滤后也是样本不均，导致大量无效买入
    我在损失函数层面实验了cost-sensitive，从
        criterion = nn.CrossEntropyLoss() 改为
        criterion = nn.CrossEntropyLoss(weight=torch.tensor([0.25, 0.59, 0.08, 0.08]))  没什么用
    https://zhuanlan.zhihu.com/p/494220661
        这篇提到了其他解决办法：
            模型层面用决策树、
            集成学习中把少的样本重复抽样，组成训练子集，给单个模型
            样本极端少只有几十个时，将分类问题考虑成异常检测
        这实验起来有些麻烦，我先尝试直接删样本吧，handle_uneven_samples True处理，False不处理，按4类中最少的为准，删除其他样本
    最后决定不再处理样本不均，让策略、标注等都做自己最擅长的事情，最后投票

2025 02 05 更换特征
    5分钟3天、15分钟10天、30分钟20天，那三个级别用160步长，找macd+kdj 解释：识别出的是真正的背离形态，我自己算的背离形态太容易倍小改变干扰
    5分钟行不行，让15、30去判断，日线的数据级别差太多就感觉不出变化
    短线就不如长线么？并不是，根据实验，单级别收益率都差不多
    不同的策略，不同标注，不同级别，不同模型，不同市场，各有解决办法，让大家做自己擅长的事。！！！！！

2025 02 07 关于引入更多策略
    传统策略回测，标注，模型预测比传统策略的收益率有提升。小创新。  实验时需要加很多策略
            斐波那契回调
            Momentum  Oscillator
            波浪理论
            压力线等，tradingview中有很多现成的
    实践后发现，没有惊艳的效果，也就是优化策略这路走不通，本质上一种策略无法适用于所有场景。
    解决办法是：识别当前是什么场景（趋势、反转、震荡、突破），因地制宜用指标

3、训练
    没有一个策略能适应所有情况，理智的做法是为各种情况作出应对方案。
        1、标的选择
            使用选股策略选出股票，长期持有
            选择指数
            所有股票都参与
        2、策略选择
            对于大众，均值、趋势是两个相反方向，每个方向都有几十种指标和策略
            a股 适合波段，周期策略  港股 美股 数字币 适合趋势策略


四  experiment
    评价指标：主要用sharpe ratio,ROI,max drawdown
        评估模型性能的指标：主要用mean absolute percentage error (MAPE) - 33%, root mean square error (RMSE) - 33%, accuracy (31%),
        mean absolute error (MAE) - 29%, mean squared error (MSE) - 29%, F measure (F1) - 20% and precision (20%)


2025 02 27  汇报
1、标注方法
    我的初衷是，传统策略回测交易点，我制定规则过滤 1有效买入、2无效买入、3有效卖出、4无效卖出 4类。
    极值标注。
    实验预期：  1、传统标注——极值点标注就是 Label_extremum.py，训练个CNN，不如我8策略标注CNN 性能好  证明 用策略标注比传统标注强 思路小创新
                 accuracy:0.4274740622505986  我0.6  但是换特征后大家都准确率差不多，看sheet1
    结论，标注创新一般，模型感觉不到，减少计算量，收益看实盘了

2、挑出1、3类（代表最高收益率），选特征
   60分钟+日线+指数 价格+成交量，准确率0.6，实际预测结果1000次只有4次有效买入，相当于全选C，无法统计收益，推测样本不均导致
   变权重，没用。
   删样本，有用， 准确率0.4  实际预测结果中有效买入次数增多。

   考虑其他特征提取方式：同样的高级别形态，小级别有买有卖，6个特征有4个没变化，因此起决定作用的还是小级别特征。
        5分钟缺点是频繁，忽略大趋势，模型识别特征不容易，考虑删除5分钟级别
        但是，经过实验，800个股票其中82%收益率高于不含5分钟交易点的股票。但是仓位翻倍。放弃剔除

   60分钟+日线+指数 改指标相关特征，准确率0.5
   改级别，5+15+30  准确率0.6，
   单级别，         准确率0.6，

   实验发现，单级别准确率跟多级别组合差不多。解释：识别出的是真正的背离形态，我自己算的背离形态太容易倍小改变干扰
   最终3种特征，原始 1、价格+成交量， 2、策略对应指标， 3、全指标.

   结论：全指标挺好。

3、找策略
    找了7个，
        1、趋势 fuzzy，利用模糊理论，基于均线，判断当前是买方强势还是卖方强势，跟随强者操作。
        2、趋势 MACD（带signal）+ RSI + EMA60 + 收盘价：适合趋势市和中长期趋势，适合中长线交易者。
        3、趋势 MACD + KDJ + 收盘价：适合震荡市和短期趋势，适合短线交易者。
        4、震荡 boll + RSI + 收盘价：震荡策略。
        5、震荡 KDJ：震荡策略。
        6、突破 震荡转趋势 boll + ATR + 成交量 + 收盘价。
        7、反转 趋势转趋势 MACD（带signal）+ obv + ema10 + ema60。

    实践后发现，没有惊艳的效果，也就是优化策略这路走不通，本质上一种策略无法适用于所有场景。
    解决办法是：识别当前是什么场景（趋势、反转、震荡、突破），因地制宜用指标

    实验预期：  2、模型收益率比原策略强，证明 多变量时间序列分类金融+四分类+单模型 这个组合能解决收益率问题 思路小创新
                                    收益率提升20%
    结论，传统策略+CNN有用，加个行情分类模型能再提升10%。
4、训练模型。
    训练模型时多级别共同抽取特征，改为靠行情分类模型。7个策略+1行情识别，8个CNN

    实验预期：  1、加入行情分类模型后，原策略收益提升、策略模型收益/准确率提升  证明 行情分类模型思路比死磕单策略强 思路创新
              2、各级别分类模型+各级别各策略模型  决策融合 特征融合？（我多级别特征组一起应该就是） 这方面研究已经有了，作为论文方向的支撑。
                    多级别+多策略+甚至不同策略不同模型 或 不同级别不同策略  这么融合，比单级别 或比 多个相同模型 或比 单策略 收益率高，
                        证明 融合思路 创新

5、创新点：相同特征下，标注不比他们强。  标注方向放弃
           各自指标和通用指标没区别     特征工程方向放弃
           策略+模型，收益率有提升。    CNN和timesnet等区别不大，模型设计方向放弃？
               1、模型本身优化  CNN有道理的加东西，  自注意力的位置编码  试别人的CNN架构！！！！！！！
               2、样本不均，找相关论文的方法用！！！！！！！  搬别人的用  样本不均确实是个大问题。  我删样本的方法简单但有效，可以放弃样本不均方向。

           创新点只剩 1个策略模型。 此基础上进一步提升收益率——行情分类模型分类组合各级别做决策融合，再次过滤策略模型的1、3。
           实验试了各策略 各分钟级 预测数据，然后预测其上级分钟、日、指数日的行情类型。结论如下
                有效买入点大都在下跌行情，上涨、震荡时很少，
                但在下跌行情中，有效买入点猜对和猜错的数量差不多。行情分类不能过滤掉猜错的情况
                有效卖出大都在上涨行情，同样猜对猜错概率差不多，没必要加判断。

                对于分钟级，日线、指数，都处于下跌时，有效买点猜对猜错都挺多。多级别组合没用
                总结：行情分类确实分出类了，对应行情中对应策略交易点最多，其他行情几乎没用这个策略的交易点。但是
                    交易点的对错一半。
                    趋势、震荡行情应该等待。要识别的是现在是否是反转、突破。

------------------------------------------

    实盘，对于一个股票，七种传统策略出信号，时间窗口拿数据，转ts，进对应模型预测4分类，若1、3，时间窗口再拿数据，进本级别行情分类模型预测3分类，
        过滤1、3，留下的还是1、3，高级别加权重评估风险，给概率，仓位建议。

    行情分类模型的各级别融合写在了temp1，关键问题在于级别组合方式是否合理
------------------------------------------
超参，数据，记录每次结果，避免随机变量
准确率至少0.6，



报错：
    前复权会导致很久以前的股价出现负数，坑啊
    行情分类做ts时忘记改为3类了
    ValueError: Expected input batch_size (1) to match target batch_size (0). 这个报错是数据量运气不好，随便改一下数据量就好了
    C:\actions-runner\_work\pytorch\pytorch\builder\windows\pytorch\aten\src\ATen\native\cuda\Loss.cu:250: block: [0,0,0], thread: [8,0,0] Assertion `t >= 0 && t < n_classes` failed.
    这个报错是分类有问题，要么模型最后的分类不是四类，要么ts文件里label有Nan导致分类不是4类
    fuzzy,kdj,极值，这三个回测后都是交易对，要先预处理，再标注，不然标注会出现Nan，训练时会出现Nan类
    run里面多个策略同时跑，导致订单出现错误，数据混乱
    point_to_ts_single 是找当前级别数据，如果某一行数据有问题直接跳过
        point_to_ts_up_time_level 对分钟级来说，是找上级，因此本级别找的行数不同，原来有问题的行可能被跳过。因此导致预测行数与行情预测时的行数对不上
        解决办法只能在计算完指标后，填充Nan

五  result
收益率做评价指标，用王立新那种回测作为结果
评估指标方面，用户需要注意不要只看准确率，而应该关注召回率、F1分数，尤其是对少数类的表现。可能需要使用混淆矩阵、AUC-ROC曲线等来全面评估模型性能。


六  conclusion
以上方法是传统指标与深度学习组合，在挖掘各级别形态的关系时，是各自总结规律，按权重投票


--------------------------------------------------------------------
参考文献
# 数据标注23、24年
1 可 对数——日内预测，先把5分钟级别的临近价格转为对数形式，然后用线性、机器学习模型训练模型，预测准确率1%以下
2 可 CNN 多级别——CNN和图神经网络结合，多级别数据 和 情绪分析，最终策略胜率比 买入持有策略高50%  真复杂
3 可 集成学习 粒子群算法调参？——LSTM和GRU 集成学习，准确率56%，再用PSO粒子群算法调参，准确率最终57%  印度的
4 价格变成图，效果一般
5 可 指标——本研究采用深度学习和数据聚类方法
        提出一个可解释的自动化金融市场交易模型。在提出的方法中，特征向量
        首先从市场价格指数和有用的指标(如RSI和MA)的值中提取。数据
        然后通过聚类执行标记。然后，创建一个数据集来训练深度学习模型
        为了确定并采取最佳行动(买入、卖出或不采取行动)。在金融市场上，价格可能会变化
        极大地破坏了学习模型的性能。为此，设计了一种自编码器网络
        识别市场中的剧烈波动(异常值)并避免在这种情况下进行交易。这可以防止陡峭的下降。
        感觉靠谱  但结果提升不多

6 强化学习，收益率高个20%
7 多模态融合，年26%
8 只做走势研究，看看有啥特点   没啥用
9 模糊  准确率提升60%
10 本文提出了一种新型的混合模型SA-DLSTM
    结合情绪增强卷积神经网络进行股票市场预测和模拟交易
    网络(ECNN)、去噪自编码器(DAE)模型和长短期记忆模型(LSTM)。
    首先，利用互联网用户生成的评论作为股票市场数据的补充，并利用网络用户生成的评论作为股票市场数据的补充
    采用ECNN提取情感表示。其次，我们提取的关键特征
    利用DAE对股票市场数据进行预测，可以提高预测精度。第三，我们重视时效性
    考虑股票市场情绪，构建更可靠、更现实的情绪
    索引。最后，将股票数据和情绪指数的关键特征输入到LSTM中，生成股票
    市场预测。实验结果表明，SA-DLSTM的预测精度优于SA-DLSTM
    其他比较模型。同时，SA-DLSTM在收益和风险两方面都有较好的表现。

11 可 多级别 图识别——只讲准确率，没讲收益率
12 识别图像，没讲收益率，但有代码
13 资产组合优化  选股策略
14 深度强化学习，收益率 8%~52%
15 This paper proposes a novel Recurrent ensemble deep Random Vector Functional Link (RedRVFL) network
        递归集成深度随机向量函数链路  只提了价格预测准确率  mae 3
16 本研究为股票开发了一个称为MVL-SVM的混合模型
        通过集成多视图学习和支持向量进行价格趋势预测
        机(SVM)。它的工作原理是简单地输入异构的多视图数据模拟
        neous，这可能会减少信息损失。与阿丽玛的经典相比
        基于单视图和多视图数据，我们的混合模型显示了统计量
        优势显著。在稳健性检验中，我们的模型表现优于其他模型
        设置新闻和市场数据的滑动窗口时，准确率至少为10%

17 群惩罚三项式logit动态模型 预测三种趋势的
18 遗传算法
19 新闻中提取关键词  准确率提升5%
20 强化学习
21 数据预处理  去噪  沪深300
22 模型预测数字币，没有万能模型，各自有自己使用的情况
23 多代理  强化学习，融合了timesnet
24 仓位管理
25 情绪分析
26 数据预处理  数字币
27 预测美元化率的方向
28 模型可解释性
29 可 标注，但还不如传统指标——NPMM标记是一种有效的股票价格趋势预测标记方法  与其他标记方法相比，产生交易优于其他标记方法
    传统方式通过上、下标注所有时间点，小波动多导致模型性能差。提出 N-Period Min-Max 标注法
    介绍里讲股票预测发展历史，引出数据标注重要性
    上下标注法抓不到趋势，2020wu那篇用深度学习方法抓特征用来标注出趋势
    受启发与2018年找V型的文章，做了小改动，就是挑出两个极值点，再拿当前价格和两个极值比，越来越小说明跌，反之涨，V型过滤了小波动。  创新小
    XGBoost 能做分类和回归，用作模型，预测每个bar时有阈值0.5，用来分类
    买卖策略：出现连续几个相同的就交易
    图6是实验效果，不如我传统指标准，我再加多级别，模糊策略退5天，多指标做投票

    总结：传统标注每个bar都标上下，但价格波动影响大，比如一串下里常出现几个上，作者也是每个bar都标，但由于V型做铺垫，
    忽略了各种意外变动，一串下里多个上变成只有真正拐点的一个上。

30 基于图像训练   把多特征放到多通道
31 可 标注，但效果不惊艳——数字币  趋势标注
        a new attention-based CNN–LSTM model for multiple cryptocurrencies (ACLMC)
        受启发与2018年的文章，用局部最小值组成的序列代替原始价格，以抹除小波动。
        趋势分三类，上，下，平稳，平稳状态不交易   （数字币能做空）
        对同级别数据，通过weight-sharing进行encoder，以标识基本信息，
        把不同级别、不同币的信息通过两个注意力层组合起来，以挖掘些特征
        多个预测器同时做预测，能够促进模型训练，并且能同时交易多个币
        相关论文：  均线还是有噪音影响，2022年ozer 用k临近算法移除了远离中心的价格，降低了噪音，但缺点在于抓不到行情反转
        标注方法类似布林通道，每个价格都去和上个极值点比，再乘当前趋势值d，与阈值超参做对比，如果打破了，就开启新的趋势和区间
        没有打破则维持趋势。   这种是会有误判的

32 利用VIX-Lasso-GRU模型对股指期货进行定价  5分钟  A股

--------------------------------------------
# 数据标注  旧的
2006Mining of Stock Data Intra and Inter-Stock Pattern  51
    挖掘两股票间关系，值得看

2015Classification and Prediction of Stock Market Index Based on Fuzzy  99
    模糊的，不看

2016 A novel forecasting method based on multi-order fuzzy time series and technical analysis  1区 120
    multi-order fuzzy time series, 核心
    technical analysis 构成fuzzy
    and a genetic algorithm  找最佳划分点
    模糊理论是另一个领域了，学习成本太高

2016Stock prediction using deep learning  4区 335
    一般

2016Fuzzy transfer learning in time series forecasting for stock market prices 3区 11
    模糊的

2017A Comparative Study on Trend Forecasting Approach 会议 39
    综述，MLP准确率最高

2017 Convolutional neural networks for time series classification  3区 906
    方法里说，之前有人把多变量变为单变量做输入进行训练，这样忽略了多变量之间的内在联系，于是作者直接用多变量训练卷积网络
    仔细看看

可 数据集用到了——2018The UEA multivariate time series classification
                没金融

可——2019 Genetic algorithm-optimized multi-channel convolutional neural network for stock market prediction  3区 ref190
    focus on the optimization of feature extraction part of CNN,
    proposes a method to systematically optimize the parameters for the CNN model by using genetic algorithm (GA).
    26 27 44 29 46
    if the problem is too computationally complicated to be solved, GA can be used as a method to obtain a solution close
    to the optimal one
    用的方法是use a deep multi-channel CNN framework for amultivariate time-series classification
    用CNN因为它善于捕捉局部相关，
    原始数据5个特征，用指标预处理，变为7个指标特征，分为7个channel，进入CNN，通过计算分数分类，输出2类 up/down trend
    训练数据的label怎么来的，没说

2019 Deep learning-based feature engineering for stock price movement prediction  1区 445
    提出多过滤器神经网络，能抓取特征并预测价格方向，比LSTM、CNN等强2%，准确率也只有48%
    数据标注还是用每天收盘价波动幅度，分为涨，震荡，跌

2019Stock Price Movements Classification Using Machine and Deep Learning Techniques-The Case Study of Indian Stock Market
    会议 53
    使用 Boruta feature selection technique选择特征 （基于高均值用随机森林找重要指标）
    深度学习比机器学习准确率高5%
    数据标注用当前价格和之前价格比，二分类，实验准确率83%

2019 Stock market forecasting with super-high dimensional time-series data using ConvLSTM, trend sampling, and specialized data augmentation
    1区 102
    提出个新预测框架NuNet，能做超高维度的市场信息特征提取。
    把各指数数据都补全为4000个时间步
    1个数据和他之前t个时间步的数据一起进网络，预测明天价格

可 时序分类——2019Deep learning for time series classification a review 3区 3224
            在时序分类领域，深度学习还没有很多应用。
            数据定义有3种，单变量、多变量、一对张量X,Y，Y是label
            然后讲了几种模型处理数据的过程，都是一般步骤

2019Financial Trading Model with Stock Bar Chart Image Time Series with  4区 67
    直接用蜡烛图做CNN，用了30个股票，30天的日线bar  （启发，把每个股票的价格都标准化，那就可以用很多股票训练了）
    相关工作里只有一篇跟他类似
    在30个bar的蜡烛图中，计算价格斜率，决定label为买、卖或不动。

可 多级别——2019Multi-Scale RCNN Model for Financial Time-series                 arxiv 7
            多级别属性影响，临时依赖
            我想过不同时间级别彼此综合判断，个股和大盘的依赖关系
            引用11，多级别已经被广泛探索了
            多级别相关论文就2篇
            临时依赖有3篇，但都是单级别

            预训练迁移到其他股票，迁移误差千分之5
            标注：选取重要的指标做特征，不同模型选出的重要特征不一样
            大部分都是用当前价格和前一天比较，来分类涨跌做标注，或是回归
            有个从蜡烛图提取K先，然后分形态的
            有nlp的
            有个蜡烛图做CNN的

可 写作方式——2019Stock Market Analysis A Review and Taxonomy of   2区 引用 492
            叙事的方式不错，可读性强，可以当作这个领域的历史了解

2019Anensemble of LSTM neural networks for high-frequency 3区 226
    在每一个bar上做分类，虽然频繁，也和变长步预测一次涨跌不是一个方向，但这种方式确实适合做高频，比如5分钟bar的BTC。

2019Stock Market Trend Prediction Using High-Order  3区 189
    准确率一般

可 数据标注 过滤短期随机性 技术分析——2020 A Labeling Method for Financial Time Series Prediction Based on Trends  3区 ref61
    哈工大QS256
    传统标注数据方法，是比较数据当前值和未来短期内的值，但短期的随机性太强，捕捉不了连续趋势的特征。
    所以作者提出方法“连续趋势标注”
    How to label financial time series data to
    determine the prediction accuracy of machine learning models and subsequently determine final
    investment returns is a hot topic
    How to evaluate the prediction performance of a machine learning
    model in the financial market is also a hot topic    23说交叉验证是最好的方法
    然后讲怎么选特征
    41说大量研究者用技术分析做时间序列预测
    回归不需要标注数据，分类需要。
    51就是通过价格对数分类下一刻涨跌，这样每一刻都能做分类，65说对数的变动更难预测
    这句说的很多，股票价格受宏观和公司基本面影响，商品价格受宏观和需求影响，外汇价格受汇率和国际环境影响
    所以，是本质因素导致了趋势，而短期的随机因素影响不大。

    自动标注比传统标注方法好

    作者先拿出收盘价，做了个单变量矩阵，时间步是11。他叫矩阵扩展
    通过窗口解决了look-ahead bias
    想识别趋势，要先定义趋势，作者用的方法是先拿出所有极值点，极大值们、极小值们各放一个向量，然后计算临近两对极值点的涨跌幅，
    达到某个阈值（实验表明15%效果最好），则说明趋势反转，否则视为噪音波动。图2label1是传统标注方法，就是笔记开头提到的。
    作者按照趋势的算法，给每个价格一个标签（-1,1），以说明这个价格当前在什么趋势里
    实验评估用准确率召回率那类

    策略是分类为1就买，变-1就卖。模型训练出了判断此刻跌是趋势改变的能力。模型KNN，逻辑回归，随机森林，SVM，LSTM，GRU


2020 A pattern representation of stock time series based on DTW  3区26
    Dynamic Time Warping (DTW) 是个抓取时间序列形态特征的工具，从原始序列里抓出个子序列
    作者用Particle Swarm Optimization algorithm解决全局最优问题，提出PR-DTW方法，用于捕捉短期特征
    这个方法用10天数据预测3天，用决策树、多层感知机做了分类预测实验，成功率70%
    引用5,2007年技术指标，6、2011年波浪理论，7、2018滑动窗口深度学习回归，8、2018模式分类
    已有的时间序列表示方法有三类：
        基于表示的生成模型：马尔科夫、贝叶斯网络、深度学习等
        基于表示的转换模型：把原始数据转为时间序列的特征空间，包括傅里叶变化、波浪转换、余弦转换等
        基于表示的时间域：从原始数据获取有代表性的点，包括分段线性近似、分段集合近似等

可 作为介绍里的引子，介绍历史——2020 Stock market movement forecast: A Systematic review  1区287
                    普通，先讲预测分为 基本面、指标、消息，然后论文都是数据+模型
                    输入的数据分为价格、指标、消息等
                    模型分为ANN，SVM，深度学习等

2020 An improved deep learning model for predicting stock market price time series  3区139
    在金融预测领域，这个时期（2020年之前那几年）深度学习用的还不多，主流做法是数学统计、模糊理论做股指预测，其次是机器学习的
    随机森林、决策树、ANN，效果一般。后来的深度学习LSTM比之前那些强
    作者用LSTM 做股票收盘价预测，属于回归

可 作为介绍里的引子，介绍历史——2020Financial time series forecasting with deep learning A systematic  1区1071
                    这两年深度学习火了，其在金融预测领域综述不多，因此有了这篇
                    介绍了Deep Multi Layer Perceptron (DMLP)、RNN、LSTM、CNN、Restricted Boltzmann Machines (RBMs)、
                     Deep Belief Networks (DBNs)、Autoencoders (AEs)、 Deep reinforcement learning (DRL)
                    又介绍金融时序预测，4.1股票价格预测、4.2股指预测，就说数据是5个特征，用了什么模型做预测，也不提分类还是回归，不提具体数据标注
                    table10列举了趋势预测的几篇论文

2020Optimizing LSTM for time series prediction in Indian stock market  会议 316
跟最新的时序预测比太老了，还是价格回归。

可 提了多步分类——2020Stock Price Prediction Using Convolutional Neural     印度的会议 引用164
                输入类型分为三种：
                    多时间步单变量
                    多时间步多变量，每个输入序列一个通道
                    多实践步多变量，每个输入序列用不同子模型，最后在预测前合并结果
                结论，深度学习模型比机器学习模型强，多变量比单变量准

可 数据集样本不均衡时可以增大，但我选了减少——2020EVALUATINGDATAAUGMENTATIONFORFINANCIALTIMESERIESCLASSIFICATION   arxiv 16
                                    data augmentation 数据增大，cv领域用的多，作者也想在时序领域用
                                    股票时间序列训练数据少，作者对比了八种增大数据的方法，发现有三种对模型泛化能力有提升

2020Multiple Stock Time Series Jointly Forecasting with  三流会议，11
    把多个相关股票一起训练做预测，比如银行业，航运业等，这么做的确实不多

可 讲到特征选择时提一下，但我用的是策略特征——2021 Forecasting daily stock trend using multi-filter feature selection and deep learning  1区 110
                                        用多个特征选择技术生成一个特征子集。
                                        用88个股票的44个指标，通过独立训练逻辑回归模型计算指标重要性，剔除得分低的特征，把剩余的特征分类，
                                        再从每类中选出最重要的特征，生成特征子集
                                        二分类，每天价格变化 <-0.5为0，>0.5为1
                                        Xu, Y., & Cohen, S. B. (2018). Stock movement prediction from tweets and historical
                                        prices. In Proceedings of the 56th annual meeting of the association for computational
                                        linguistics (volume 1: long papers) (pp. 1970–1979).

2021The great multivariate time series classification bake off a  3区 406
多变量时许预测的综述

可 提了股票预测历史，介绍里可抄
    他从蜡烛图总结走势，我是直接给走势分类当前是不是拐点
        ——2022 A stock time series forecasting approach incorporating candlestick patterns and sequence similarity  1区27
                    现在的模型可解释性差，不能迁移到不同数据
                    首先通过序列模式挖掘，挖出蜡烛模式，再用序列相似性去匹配不同的蜡烛序列。
                    此方法准确率56%，SVM 50%，LSTM50%
                    蜡烛模式就是蜡烛图里的序列，
                    Chen, J.-H., & Tsai, Y.-C. (2020). Encoding candlesticks as images for pattern
                    classification using convolutional neural networks. Financial Innovation, 6. https://
                    doi.org/10.1186/s40854-020-00187-0 用蜡烛图做趋势分类
                    作者通过12篇论文总结了一下股票预测：
                        分为价格回归、趋势分类
                        很难比较，因为大家用的数据不同，趋势都不一样
                        数据规模小
                        大家论文的模型无法为每个股票做单独调优
                    Fig.7 作者从蜡烛图提取K线，总结出12种拐点形态及其对应趋势（上或下），再从中挖掘规律。有创意，太复杂了，准确率才56%

2023 A Bayesian‑based classifcation framework for fnancial time series trend prediction  3区 ref9
        作者来自谢里夫理工大学，伊朗最好的理工大学，QS406
        这也是做价格趋势预测的数据标注，用贝叶斯优化技术找到最好的超参。
        跟上面比，作者把一定范围内波动作为第三个类别——不操作。本质还是判断阈值，系数叫涛。
        两篇论文太像了，也是几个模型，也是召回率准确率做评估。

2023 Augmented bilinear network for incremental multi-stock time-series classification 1区 6
    预训练模型如何快速用到别的数据集上。他这种方法能使迁移后准确率误差在0.5%之间

2023Multi-source aggregated classification for stock price movement prediction  1区71
    核心是Fig.1，通过NLP分析新闻，历史价格等，集成个结果给BiLSTM，输出结果

2023 Improving stock trend prediction through financial time series  3区6
    作者筛选股价极值点的想法不错

-----------------------------------------------------------------------------
参考文献
# 时间序列模型
2017 transformer
transformer encoder多个头的结果压在一起，给decoder，
decoder循环，训练时，decoder inputs是未来的真实值；预测时，inputs是decoder的output上次的预测值

2020 ADD 股票数据特征提取
1、非纠缠结构分离 excess and market information
2、通过自蒸馏抹去部分因素
3、通过策略增加训练样本

**2021 informer**
稀疏概率降低复杂度，蒸馏使输入变长

**2021 Autoformer**
用到了decomposition，这个拆分（快速傅里叶变换FFT）基于 STL（季节性，趋势性），数据=趋势性数据+季节性数据（周期）+余项
auto-correlation代替注意力，因为作者认为数据不能简单由数值来判断，而应该根据趋势来判断，series-decomp用来把原始数据分解成季节（频繁小震荡）和趋势（大趋势），
auto-correlation利用随机过程的马尔可夫过程，以涛为时间窗口，计算分解后的两个周期对应那两小段的相关性，是个标量（最后加个softmax保证计算出的多个标量和是1），多个计算的标量连起来就是个趋势。
编码器是原始输入，解码器是拆分后的季节性和趋势性
结论：他对季节性周期性强的数据，预测效果最好，比如车流（有早晚高峰，工作日比周末车少）

**2022 Dlinear**
双线性结构。decomposition先分解原数据的趋势和季节。
论文里的金融预测图
对于周期性不强的金融数据，mse这类评价指标低真没啥用，图说明，模型只是简单延续了趋势，并不能预测趋势反转，
属于 MLPs

**2022 TDformer**
Trend Decomposition Transformer
20引用
各个趋势用自己适合的注意力机制

**2023 mamba**
循环神经网络 训练慢，推理快， transformer训练快，推理慢，mamba两个都快，训练时并行计算，推理时递归计算。
让SSM由时不变改为时变。速度快了2.8倍，内存少了86%

**2023 GBT**
Two-stage transformer framework for non-stationary time series forecasting
认为decoder inputs存在问题：不同局部窗口数据分布不均
现有的decoder inputs设计：
	informer：start token前移几位作为decoder的输入
	FEDFormer：趋势分解方式
这两个都没有解决过拟合问题
创新点：
	two stage:第一阶段通过对比学习获得输入序列的通用特征映射，第二阶段通过第一阶段和回归器输出的表征获得预测结果
	good begin：第一阶段的输出做第二阶段的输入

**2023 ITRANSFORMER**
INVERTED TRANSFORMERS AREEFFECTIVE FOR TIME SERIES FORECASTING
认为transformer-based模型不如Dlinear是因为token的不恰当使用
多个特征取了相同时间位置的token，但应该每个特征看作一个token
通过自注意力机制捕获特征之间的相关性
学习序列和全局的关系
金融预测效果比dlinear差一点

**2023 TimesNet**
时间序列的多周期性，互相重叠，互相影响
通过建模同时表示周期内和周期间的变化
autoformer团队的
属于CNNs

**2023 PatchTST**
原来的transformer是点对应token，现在是时间段对应token
通道独立，每个特征各自进transformer
目前效果最好的时间序列预测

2023SegRNN
也是分段 + 通道独立

2023 StockFormer
Learning Hybrid Trading Machines with Predictive Coding
强化学习，但又跟普通的马科夫不一样，收益从0.4%提升到2%，一般
StockFormer consists of two training phases: predictive coding and policy learning

2023 Stock and market index prediction using Informer network
LSTM在时序预测上处于统治地位 ，Transformer有超越他的潜力，但现在这方面研究不够深入
在长序列预测上，Informer比LSTM、Transformer表现更好

**2024 TimeMixer**
autoformer团队的
完全基于MLP模型，简单
多尺度混合：
	历史信息提取阶段：分解多个尺度变化
	预测阶段：多预测器混合多尺度信息
实验结果显示他是第一，TimesNet第二，PatchTST第三

**2024 TimesFM**
A DECODER-ONLY FOUNDATION MODEL FOR TIME-SERIES FORECASTING
zero-shot，不用在新数据集上训练，直接能用
预训练模型：patch input , decoder only , attention model
预训练数据集：作者做了个大型时序语料库
预测数据集：对不同领域可以zero-shot预测
NLP有跨任务zero-shot/few-shot learning的能力，这启发了时间序列预测，目前有两个研究方向：先预训练模型再给时间序列用；修改LLM模型给时间序列用
效果跟patchTST差不多

2024 MambaOut Do We Really Need Mamba for Vision
mamba适合长序列预测，视觉方面比不过卷积类模型

2024 Can Transformers Transform Financial Forecasting?
TFT、Informer、Autoformer、PatchTST 处理复杂时间序列数据很厉害，但之前有人用金融数据测的不严格，所以这次作者严格评测一下这四个。
作者之所以选这四个是因为他们在Nixtla这个神经网络实验评测的python库里
Q是当前对市场的分析，K是市场历史事件，V是市场历史事件对应当时的数据。
多头注意力类似同时考虑价格、成交量等
数据from July 1, 2007, to June 30, 2021.  Standard & Poor’s 100 (S&P 100) index
指标RMSE,MAE,MAPE
结论，Informer（长短期都强）最好，Autoformer（更适合短期）、PatchTST（更适合长期）一般，TFT不行

2024 Time Evidence Fusion Network
Evidence theory 1976年提出，融合信息做决策的 ，2000年有人用这个扩展为网络做分类，现在作者用这个做回归 Time Evidence Fusion Network
TEFN，把时间序列分为 时间BPA、通道BPA， 每个BPA又各自把序列扩散成多个mass,  (BPA源自模糊集理论)
本文说自己第一，PatchTST第二，TimesNet第三，autoformer和dlinear最后

**2024 KAN**
Kolmogorov–Arnold Networks
能抽象出公式
MLP受universal approximation theorem启发，固定了激活函数作为层中的节点，
KAN受Kolmogorov-Arnold representation theorem启发，使用可学习的激活函数作为计算节点值的权重，因此没有权重矩阵，用1元函数代替了
KAN外表是MLP结构，内部是spline，使他不仅能学习特征，还能更精确。
KA是：如果f是个多元连续有界函数，则f可由有限个1元变量累加表示。人们想用ML学出这个1元函数，但这些函数可能是不可导的，所以KA被ML放弃了
但作者觉得科学中和生活中大部分函数都是可导的，应该关注典型的例子，而不是最坏的例子。
KAN的架构就是把每个1元函数参数化为B-spline curve，
例子，Alice想用KAN拟合2.22那个函数（两个输入，一个输出）。步骤是：
先建立（2,5,1）形状的全连接层（这是2层网络（x,x,x,x）这是3层网络），通过稀疏化训练，裁减掉80%隐藏层，得到（2,1,1）形状，假设出符号函数作为网络中的激活函数，继续训练直到准确率下降以确定参数，得到最终的符号函数。
这篇文章并不是独创KAN网络[n, 2n + 1, 1]，而是把这个网络泛化成任意的广度和深度。
We would also like to apply KANs to machinelearning-related tasks, which would require integrating KANs into current architectures, e.g., transformers – one may propose “kansformers” which replace MLPs by KANs in transformers.
KAN优点是可解释性和准确率，缺点是比MLP训练慢10倍，但作者认为这是个工程问题。
https://github.com/kindxiaoming/pykan
https://github.com/remigenet/SigKAN  预测均值或中位数让数据更平稳。

**2024 Diffusion-TS**

2024 A Novel Decision Ensemble Framework
Customized Attention-BiLSTM and XGBoost for Speculative Stock Price Forecasting
用BTC-USDT训练

2024 Literature Review
Machine Learning in Stock Predictions
prediction：Linear Regression, XGBoost, LSTM, ARIMA, and GARCH 这5个是预测价格
classification：Random Forest, Logistic Regression, Adaboost, GRU, and CNN 这5个分类趋势

2024 FinRobot
An Open-Source AI Agent Platform
应用的结果不准。 用LLM分析新闻预测涨跌的



---------------------------------------------------------------------------------------
这种方法与传统金融策略做对比，投经济类期刊
一区期刊 Expert Systems With Applications
21发哪个期刊了，感觉很水
2019 有篇写作方式不错

akshare可以获取股东人数，可作为选股策略
什么题材都有故事，题材没用
主力吸收了一堆筹码，然后炒起来，卖给散户
只要主力没离场，这个股票总有大涨的机会
如果主力没来，这个股票就不需要关注
那我只要找到，主力来了，股票还没涨的，加入风投列表
然后风投的股票进入策略，等待买点出现，再等个卖点出现


数字币的期权，算概率也很不错

用期权进行策略实盘试验
当前价格100
预计5天后 会涨到110， 那我就买个5块，以100元（未来的低价）在5天后买，的期权，到了那天，真的超过110了，那我就行权，以100买入2手，马上以110价格卖出
                                                                  如果没有，那就损失个保证金
                                                                  期间我想止盈了，比如现在105，我可以卖给别人
预计5天后 会跌到90，  那我就买个5块，以100元（未来的高价）在5天后卖，的期权，到了那天，真跌了，我就在市场以90买个，马上以100卖给对方

所以，我可以只买10u，预测100u的波动。赢一次赚90u，输一次损失10u

合约在波动时有强制平仓风险，而期权不怕波动，损失固定，只要够小就可以
对冲，持有现货怕跌，买看跌期权，如果没跌，不行权，利润能盖过权利金。跌了，则对冲损失。
现货1000u1份，跌20%到800u，损失200u，要想对冲200u，则买1张看跌期权 1000u在5天后卖给对方，盈利为200u-1张的权利金（大概1%，也就是10u），即190u，
也就是说，1%，就能对冲，而且波动了百分之多少，就相当于盈利了多少倍杠杆。
如果1份价格过高，1%也很贵，这样可以买千分之一，原来赚190，现在只能转19u了，但花了1u。

他们现在买卖的，都是转卖的。比如 预计5天后到90，现在95，说明盈利5块了，那我卖5块，继续跌我才有的赚，不赚钱我5块全亏。
别看探索里转售的，直接买看涨期权，看跌期权，选日期，选心目中的价格，买个0.1张或更少即可。

币安的期权不用操作，赚了自动利润打到账户，赔了权利金直接扣掉。

期权不是100倍杠杆，
相当于自己开了个特殊杠杆
权利金就是当前和预期的价差，把价差补上，相当于自己买了个多倍合约，拥有了一个币，盈利就是1个币的价格相对期权价格的波动
这个价差越靠近当前价格，越正常，越离谱就越便宜（发生概率低，大概率扔钱）
所以，远期小概率时间收益最高，将近10倍收益
近期就是个普通的1倍，或者说一个币的波动利润

长期看涨的人远期看空对冲， 比如3800刀买了1个eth，就开空220刀1个eth  用5.7%的代价，换一个月的安心，当然涨过5.7%这样算没动，不然还要亏个5.7%作为买放心的代价

如果长期看空，那就买远期看涨对冲，比如1900刀一倍开空，270开涨，7%的代价，
总之在行权那天，如果涨破3800,270期权能弥补开空损失，但怕行权日之前涨超1900导致爆仓后又回落
                如果跌破3800，合约赚钱，但利润要大于270刀，才是真的赚

除了对冲以外，期权相当于一个防插针的合约
比如 当前3800，5刀明天看涨，到4000，才赚15刀
所以期权也有问题，就是权利金价格不稳定，200刀的利润，权利金应该是2刀  结果2刀利润只有7刀，降低了30倍
